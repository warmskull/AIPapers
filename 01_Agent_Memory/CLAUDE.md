# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

---

## AI Agent 记忆系统学习指南

本文档用于快速理解 AI Agent 记忆系统的核心概念、关键论文和技术架构。

---

## 一、为什么需要记忆系统？

### 传统 LLM 的局限性

| 问题 | 描述 |
|------|------|
| 上下文窗口有限 | 无法记住所有历史对话 |
| 跨会话无记忆 | 每次对话都是全新的开始 |
| 无法从经验学习 | 不会随着使用变聪明 |

### 记忆系统的价值

- **长期记忆**：用户偏好、历史事件、用户画像
- **短期记忆**：当前对话上下文
- **动态更新**：随时间演进的理解

---

## 二、记忆系统的三层架构（必考概念）

```
┌─────────────────────────────────────────────┐
│           长期记忆 (Long-term)               │
│  • 用户画像、偏好、历史事件                   │
│  • 存储位置：云端数据库 / 向量库              │
│  • 特点：容量大、访问慢、持久化               │
├─────────────────────────────────────────────┤
│           中期记忆 (Mid-term)                │
│  • 当前会话/行程的上下文                      │
│  • 存储位置：本地缓存                         │
│  • 特点：容量中等、访问中等、会话级持久        │
├─────────────────────────────────────────────┤
│           短期记忆 (Working Memory)           │
│  • 当前对话的即时上下文                       │
│  • 存储位置：LLM 上下文窗口                   │
│  • 特点：容量小、访问快、易丢失               │
└─────────────────────────────────────────────┘
```

---

## 三、核心论文速查

### 3.1 MemGPT (2023) - 奠基性工作

**核心思想**：借鉴操作系统的虚拟内存管理

| OS 概念 | MemGPT 对应 |
|---------|-------------|
| 虚拟内存 | 虚拟上下文（超出窗口的"假象"） |
| 内存分页 | 上下文分块管理 |
| 页面置换 | 记忆的 LRU/LFU 淘汰 |
| 中断机制 | 用户打断时的控制流处理 |

**技术要点**：
1. 分层记忆：主记忆（上下文窗口）+ 外部记忆（向量数据库）
2. 动态管理：根据需要加载/卸载记忆到上下文
3. 中断处理：用户打断时保存状态，恢复时继续

**论文链接**：[MemGPT arXiv](https://arxiv.org/pdf/2310.08560)

---

### 3.2 A-MEM (2025) - 自组织记忆

**核心创新**：Zettelkasten 笔记网络方法

| 传统记忆 | A-MEM 记忆 |
|----------|------------|
| 固定结构 | 动态索引、自动链接 |
| 孤立存储 | 知识网络、关联推理 |
| 静态属性 | 记忆进化、上下文更新 |

**技术要点**：
1. 每条记忆是一个"笔记"
2. 新记忆加入时自动找到相关旧记忆并建立链接
3. 新信息可以触发旧记忆的更新

**论文链接**：[A-MEM arXiv](https://arxiv.org/pdf/2502.12110)

---

### 3.3 Memory OS (EMNLP 2025) - 操作系统化设计

**核心创新**：三层内存架构的操作系统化设计

| 层级 | 内容 | 更新频率 | 存储位置 |
|------|------|----------|----------|
| 短期 | 当前状态 | 实时 | 上下文窗口 |
| 中期 | 当前会话/行程 | 分钟级 | 本地缓存 |
| 长期 | 用户画像 | 天级 | 云端数据库 |

**论文链接**：[Memory OS EMNLP](https://aclanthology.org/2025.emnlp-main.1318.pdf)

---

## 四、记忆系统的关键技术

### 4.1 记忆检索

| 方法 | 描述 |
|------|------|
| 向量检索 | 基于语义相似度检索 |
| 结构化检索 | 基于元数据过滤 |
| 混合检索 | 向量 + 关键词组合 |
| 重排序 | 对检索结果重新排序 |

### 4.2 记忆更新

| 策略 | 描述 |
|------|------|
| 增量更新 | 新记忆直接添加 |
| 定期重算 | 定期重新计算用户画像 |
| 重要性权重 | 根据重要性决定保留 |

### 4.3 记忆容量管理

| 技术 | 描述 |
|------|------|
| 上下文窗口扩展 | 超出原始窗口限制 |
| 记忆压缩 | 将多条记忆合并 |
| 遗忘策略 | LRU/LFU 淘汰机制 |

---

## 五、应用场景示例

### 手机助手场景

```
┌─────────────────────────────────────────────────────────────┐
│                    豆包手机助手记忆系统                      │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────┐  │
│  │  感知层 (Perception)                                 │  │
│  │  • 屏幕理解 (MobileVLM 思路)                         │  │
│  │  • 用户状态识别 (穿衣、位置、活动)                    │  │
│  │  • 环境上下文 (时间、地点、设备)                      │  │
│  └──────────────────────────────────────────────────────┘  │
│                          ↓                                  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  记忆层 (Memory - Memory OS 三层架构)                │  │
│  │  ┌────────────────────────────────────────────────┐  │  │
│  │  │ 短期：当前对话上下文 (上下文窗口)               │  │  │
│  │  ├────────────────────────────────────────────────┤  │  │
│  │  │ 中期：当前会话/场景记忆 (本地缓存)               │  │  │
│  │  ├────────────────────────────────────────────────┤  │  │
│  │  │ 长期：用户画像、偏好历史 (云端数据库)            │  │  │
│  │  └────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────┘  │
│                          ↓                                  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  推理层 (Reasoning)                                  │  │
│  │  • 意图识别 • 上下文决策 • 个性化响应生成            │  │
│  └──────────────────────────────────────────────────────┘  │
│                          ↓                                  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  行动层 (Action)                                     │  │
│  │  • UI 操作 • APP 启动与切换 • 系统设置调整          │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## 六、术语表

| 术语 | 解释 |
|------|------|
| **VLM** | Vision-Language Model，视觉语言模型 |
| **SFT** | Supervised Fine-Tuning，监督微调 |
| **RAG** | Retrieval-Augmented Generation，检索增强生成 |
| **RLHF** | Reinforcement Learning from Human Feedback，人类反馈强化学习 |
| **DPO** | Direct Preference Optimization，直接偏好优化 |
| **NPU** | Neural Processing Unit，神经网络处理器 |
| **INT8/INT4** | 8位/4位整数量化，模型压缩技术 |
| **QAT** | Quantization-Aware Training，量化感知训练 |
| **Token** | 文本的基本单位 |
| **Context Window** | 上下文窗口，模型能处理的最大文本长度 |

---

## 七、相关文档

| 文件 | 描述 |
|------|------|
| [`Agent_记忆与感知论文清单.md`](Agent_记忆与感知论文清单.md) | 完整论文列表，按研究方向分类 |
| [`2小时速成知识框架.md`](2小时速成知识框架.md) | 2小时速成框架，含面试话术 |

---

## 八、延伸阅读

### 开源项目

- **MemGPT** - 记忆管理系统
- **LangChain** - Agent 开发框架
- **PersonaMem** - 个性化评测基准 [GitHub](https://github.com/bowen-upenn/PersonaMem)
- **Qwen3-VL** - 阿里最新 VLM [GitHub](https://github.com/QwenLM/Qwen3-VL)

### 其他重要论文

| 论文 | 方向 |
|------|------|
| Generative Agents | 斯坦福小镇，长期记忆驱动社交行为 |
| Reflexion | 自我反思记忆、从失败中学习 |
| HiAgent | 层级化工作记忆 |
| Qwen2.5-VL | 端云协同 VLM |
| MobileVLM | 移动端 UI 理解 |
